{% extends "aboutus/base.html" %}
{% block title %} CEOM: Statistics {% endblock %}
{% block content %}
<h2 style="color:red">CEOM Website Photos Statistics</h2>
<hr/>
<div class="row mx-0">
    <label class="pt-1"><strong>Select Year Range:</strong></label>
    <select id ="YEAR_MIN" class="form-select form-control col-sm-2 mx-2">
        <option selected>From...</option>
        {% for year in year_range %}
            <option value="{{ year }}">{{ year }}</option>
        {% endfor %}    
    </select>
    <span class="pt-1"> - </span> 
    <select id ="YEAR_MAX" class="form-select form-control col-sm-2 mx-2">
        <option selected>...To</option>
        {% for year in year_range %}
            <option value="{{ year }}">{{ year }}</option>
        {% endfor %}    
    </select>
    <button class="btn btn-primary mx-2" onclick="chart_limitation()">Apply</button>
</div>
<div id="container" class="my-3" style="min-width: 310px; max-width: 750px; height: 450px; margin: 0 auto"></div>

<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script>
    var type = "{{ type }}";
    var str = "/aboutus/stats/photo/?p=" + type;
    var year_list = {{x_values}};
    var data_list = {{y_values}};
    const options = {
        chart: {
            zoomType: "xy",
            scrollablePlotArea: {
                minWidth: 700,
                scrollPositionX: 0
            }
        },
        credits: {
            enabled : true,
            href : "http://www.ceom.ou.edu",
            text : "ceom.ou.edu"
        },
        xAxis: {
            categories: year_list,
            lineColor: "#665f5f",
        },
        yAxis: {
            allowDecimals: false,
            lineColor: "#665f5f",
            lineWidth: 1,
            min: 0
        },
        tooltip: {
            headerFormat: '<b>{point.key}</b><br/>',
            pointFormat: '<span>#photos: {point.y}</span>',
        },
    }
    if (type == "cum") {
        options.chart.type = "spline";
        options.title = {text: "<strong>Cumulative Photos by Year</strong>"};
        options.yAxis.title = {text: "<b>Total Photos Uploaded</b>"};
        options.series = [{
            name: "Total Photos",
            data: data_list,
        }];
    } else {
        if (year_list.length > 10)
            options.chart.scrollablePlotArea =  { minWidth: 1200 };  
        options.chart.type = "column";
        options.title = {text: "<strong>New Photos Uploaded by Month and Year</strong>"};
        options.yAxis.title = {text: "<b>Number of New Photos Uploaded</b>"};
        options.plotOptions = {stacking: "normal"};
        options.tooltip =  
            {  
                formatter: function() {
                    sum = 0;
                    for(let i = 0; i < 12; i++){
                        sum += data_list[i][this.point.x];
                    }
                    return '<b>' + this.x + '</b><br/>' +
                    this.series.name + ': ' + this.y + '<br/>' +
                    'Total: ' + sum ;
                },
            };
        options.series = [
            {
                name: "January",
                data: data_list[0],
            },
            {
                name: "February",
                data: data_list[1],
            },
            {
                name: "March",
                data: data_list[2],
            },
            {
                name: "April",
                data: data_list[3],
            },
            {
                name: "May",
                data: data_list[4],
                stack: "May",
            },
            {
                name: "June",
                data: data_list[5],
            },
            {
                name: "July",
                data: data_list[6],
            },
            {
                name: "August",
                data: data_list[7],
            },
            {
                name: "September",
                data: data_list[8],
            },
            {
                name: "October",
                data: data_list[9],
            },
            {
                name: "November",
                data: data_list[10],
            },
            {
                name: "December",
                data: data_list[11],
            }]
    };
   
    $("#container").highcharts(options);
    
    function chart_limitation() {
        var year_min = $("#YEAR_MIN").val()
        var year_max = $("#YEAR_MAX").val()
        if(isNaN(year_min) || isNaN(year_max)){
            alert("Please select a valid year");
            return;
        } else if (year_min > year_max){
            alert("End year must be greater than start year");
            return;
        }
        window.location = str + "&p=" + year_min + "&p=" + year_max;
    };
</script>  
{% endblock %}